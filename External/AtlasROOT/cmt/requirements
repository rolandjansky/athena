package AtlasROOT

author Alexander Undrus <undrus@bnl.gov>

use ExternalPolicy ExternalPolicy-* External
use ROOT v* LCG_Interfaces

# Only supply linkage against the the RFIO library (and therefore libshift)
# if the ROOTRFIOLibs tag is specified.

macro use_shift    "" \
      ROOTRFIOLibs "AtlasShift AtlasShift-00-* External"
use $(use_shift)

#users are expected to select libraries that they want to link against
#by applying specific tags in requirements files of their packages;  
#for instance the following statement adds graphics libraries to linkset: 
#    apply_tag ROOTGraphicsLibs
#
#by default only basic libraries are included in linkset 
#                                                04/13/04  AU 


macro _rootBasicLibs "-L$(ROOT_home)/lib -lCore -lCint -lTree -lpthread -lMathCore -lHist" \
        ROOT_GE_6_00  "-L$(ROOT_home)/lib -lCore -lTree -lpthread -lMathCore -lHist"
        
macro rootBasicLibs ""  \
        ROOTBasicLibs $(_rootBasicLibs)

macro _rootCintexLibs "-lCintex" \
        ROOT_GE_6_00 ""

macro rootCintexLibs "" \
        ROOTCintexLibs $(_rootCintexLibs)

macro rootMathLibs "" \
          ROOTMathLibs "-L$(ROOT_home)/lib  -lMathMore -lMinuit -lMinuit2 -lMatrix -lPhysics -lHistPainter -lHist -lRint"
		  
macro rootGenVectorLibs "" \
          ROOTGenVectorLibs "-L$(ROOT_home)/lib -lGenVector"

macro rootGraphicsLibs "" \
          ROOTGraphicsLibs "-L$(ROOT_home)/lib -lGraf -lGraf3d -lGpad -lHtml -lPostscript -lGui -lGX11TTF -lGX11"

macro rootTableLibs "" \
          ROOTTableLibs "-L$(ROOT_home)/lib -lTable"

macro rootRooFitLibs "" \
          ROOTRooFitLibs "-L$(ROOT_home)/lib -lRooFitCore -lRooFit"

macro rootTMVALibs "" \
          ROOTTMVALibs "-L$(ROOT_home)/lib -lTMVA"

macro rootNetLibs "" \
          ROOTNetLibs "-L$(ROOT_home)/lib -lNet"

macro rootEGLibs "" \
          ROOTEGLibs "-L$(ROOT_home)/lib -lEG"

macro rootThreadLibs "" \
          ROOTThreadLibs "-L$(ROOT_home)/lib -lThread"

macro rootTreePlayerLibs "" \
          ROOTTreePlayerLibs "-L$(ROOT_home)/lib -lTreePlayer"

## prevent people from messing around with CINT dictionaries:
##  ATLAS is using Reflex dictionaries, they don't mix well...
macro rootSTLDictLibs "" \
          ROOTSTLDictLibs ""

# default tag:
apply_tag ROOTBasicLibs

macro ROOT_linkopts " $(rootRooFitLibs) $(rootMathLibs) $(rootGenVectorLibs) $(rootBasicLibs) $(rootRFIOLibs) $(rootGraphicsLibs) $(rootTableLibs) $(rootSTLDictLibs) $(rootCintexLibs) $(rootTMVALibs) $(rootNetLibs) $(rootEGLibs) $(rootThreadLibs) $(rootTreePlayerLibs) "

# Define pattern for packages with root files which need root cint to
# be run.
#
#   Here we define the following macros:
#
#     root_headers        - the files to be added to the dictionary
#     root_cint_includes  - the required include path. 
#     dict		  - the directory for generated files
#
#  Usage:
#

# In requirements file of package with header files to be added to the
# root cint dictionary, one should add:
#
#     apply_pattern have_root_headers root_headers=" <list of .h files> " \
#		    headers_lib=<library name> \
#                   [extra_includes=<-Iextra_dirs>]
#
# Here the <list of .h files> are the .h files to be processed by
# cint. They are assumed to be in the <package> directory with other
# headers. One MUST specify which library (headers_lib) to add the
# dictionary to, e.g. this could just be the package name. Note that
# you must make sure that the corresponding .cxx files are also put
# into the same library, e.g. library <headers_lib> xxx.cxx.
#
# The default include path is set to:
#
#   -I.. -I${ROOTSYS}/include  -I${ROOTKERNELROOT}
#
# One can optionally add in extra include paths with 
#
#   extra_includes="-I<extra_dirs>"
#

# dev notes:
# "PCM_make_target_for_<headers_lib>Dict" is used in AtlasROOT 'root_cint_header' fragment
# it's value is the name of the PCM file to install
# for ROOT5 it's empty
# "<headers_lib>Dict" is the name of the 'root_cint' document and thus the constituent

pattern have_root_headers \
  macro dict               "$(bin)dict/" ; \
  macro PACKAGE_ROOT       "$(<package>_root)" ; \
  macro <headers_lib>fullname  "$(library_prefix)<headers_lib>.$(shlibsuffix)" ; \
  macro extra_cint_includes "" \
        Darwin " -I${ROOTSYS}/cint/cint/include -I${ROOTSYS}/cint/cint/lib -I${ROOTSYS}/cint/cint/stl " ; \
  macro cint_includes_<headers_lib>Dict "-I.. -I${ROOTSYS}/include ${extra_cint_includes} <extra_includes>" ; \
  macro PCM_make_target_for_<headers_lib>Dict "" \
        ROOT_GE_6_00 "<headers_lib>Dict.pcm" ; \
  macro rootmap_opts_<headers_lib>Dict "" \
        ROOT_GE_6_00 " -rmf $(bin)<headers_lib>.rootmap -rml  ${<headers_lib>fullname} " ; \
  document root_cint <headers_lib>Dict "-s=$(<package>_root)/<package> <root_headers>" ; \
  include_dirs "." ; \
  library <headers_lib> $(dict)<headers_lib>Dict.cxx ; \
  macro_append <headers_lib>_dependencies " <headers_lib>Dict " ; \
  macro merge_rootmap_tag "do" do_merge_rootmap "do" no_merge_rootmap "dont" ; \
  macro root6_merge_only "dont"  ROOT_GE_6_00 $(merge_rootmap_tag) ; \
  apply_pattern root_headers_$(root6_merge_only)_merge_rootmap headers_lib=<headers_lib> \
      fulllibname=$(bin)$(<headers_lib>fullname)

pattern root_headers_do_merge_rootmap \
  macro library <headers_lib> ; \
  document merge_rootmap <headers_lib>_MergeMap library=<headers_lib> \
           merge_rootmap_switch="--do-merge" <fulllibname> ; \
  macro_append <headers_lib>_MergeMap_dependencies " <headers_lib> "

pattern root_headers_dont_merge_rootmap \
  macro dummy "<headers_lib> <fulllibname>" ;


# Declaration of makefile fragments for building cint dictionary
make_fragment root_cint -suffix=h -header=root_cint_header -trailer=root_cint_trailer 

# should add to make_fragment: -dependencies

macro  rootcint  "rootcint" 


 

make_fragment install_pcms -header=install_pcms_header 

pattern RootDictionary_ROOT5 \
   document rootcint <package>RootDict <headerfiles> 

pattern RootDictionary_ROOT6 \
   document rootcint <package>RootDict <headerfiles> ;  \
   macro InstallingPCM_dependencies <package>RootDict ;  \
   document install_pcms InstallingPCM <headerfiles>
   
pattern RootDictionary \
   macro RootDictionary_patternname "RootDictionary_ROOT5" \
                       ROOT_GE_6_00 "RootDictionary_ROOT6" ; \
   apply_pattern ${RootDictionary_patternname} headerfiles="<headerfiles>"
