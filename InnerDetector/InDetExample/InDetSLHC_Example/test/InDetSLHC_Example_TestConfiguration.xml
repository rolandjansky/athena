<?xml version="1.0"?>
<!DOCTYPE unifiedTestConfiguration SYSTEM "http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/unifiedTestConfiguration.dtd">

<unifiedTestConfiguration>
<atn>

<!-- ++++++++++++++++++++++++++ Running on Simulated Data  +++++++++++++++++++++++++++++++++++++++++++++ -->


<!-- Single Particle Evgen within simulation -->

<TEST name="Athena_SLHC_single_particle_sim" type="athena" suite="InDetSLHC_Example">
   <options_atn> -s InDetSLHC_Example/jobOptions_simulation_SLHC.py</options_atn>
   <timelimit>20</timelimit>
   <author> John Chapman </author>
   <mailto> chapman@hep.phy.cam.ac.uk </mailto>
   <expectations>
      <errorMessage>FAILURE (ERROR)</errorMessage>
      <successMessage>leaving with code 0</successMessage>
      <returnValue>0</returnValue>
   </expectations>
</TEST>

<TEST name="Athena_SLHC_single_particle_digi" type="athena" suite="InDetSLHC_Example">
   <options_atn> -s InDetSLHC_Example/jobOptions_digitization_SLHC.py</options_atn>
   <timelimit>20</timelimit>
   <author> John Chapman </author>
   <mailto> chapman@hep.phy.cam.ac.uk </mailto>
   <expectations>
      <errorMessage>FAILURE (ERROR)</errorMessage>
      <successMessage>leaving with code 0</successMessage>
      <returnValue>0</returnValue>
   </expectations>
</TEST>

<TEST name="AtlasG4_tf_SLHC_single_particle_sim" type="script" suite="InDetSLHC_Example">
      <options_atn>
	AtlasG4_tf.py --inputEVNTFile=/afs/cern.ch/atlas/offline/ProdData/15.6.11.3/e_E50_eta0-25-7000.evgen.pool.root --outputHITSFile=test.HITS.pool.root --maxEvents=10 --skipEvents=0 --randomSeed=10 --preInclude='sim:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py,InDetSLHC_Example/preInclude.OverrideBFieldTag.py' --geometryVersion=ATLAS-P2-ITK-01-00-00_VALIDATION --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='sim:InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py'
      </options_atn>
      <timelimit>20</timelimit>
      <author>John Chapman</author>
      <prescript>rm -f $ATN_WORK_AREA/*</prescript>
      <expectations>
            <errorMessage>FAILURE (ERROR)</errorMessage>
            <returnValue>0</returnValue>
      </expectations>
</TEST>

<TEST name="Digi_tf_SLHC_single_particle_digi" type="script" suite="InDetSLHC_Example">
      <options_atn>
        Digi_tf.py --inputHITSFile=test.HITS.pool.root --outputRDOFile=test.RDO.pool.root --maxEvents=10 --skipEvents=0 --preInclude='HITtoRDO:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py' --geometryVersion=ATLAS-P2-ITK-01-00-00 --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='HITtoRDO:InDetSLHC_Example/postInclude.SLHC_Digitization.py,InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py' --digiSeedOffset1=11 --digiSeedOffset2=22 --doAllNoise=False
      </options_atn>
      <timelimit>20</timelimit>
      <author>John Chapman</author>
      <expectations>
            <errorMessage>FAILURE (ERROR)</errorMessage>
            <returnValue>0</returnValue>
      </expectations>
</TEST>


<!-- InDet only Reco default -->

<TEST name="Reco_tf_SLHC_single_particle_reco" type="script" suite="InDetSLHC_Example">
  <options_atn>export TRF_ECHO=True; Reco_tf.py --geometryVersion=ATLAS-P2-ITK-01-00-00 --inputRDOFile test.RDO.pool.root --preInclude InDetSLHC_Example/preInclude.SLHC.SiliconOnly.Reco.py --postInclude InDetSLHC_Example/postInclude.SLHC_Setup.py r2e:InDetSLHC_Example/postInclude.DigitalClustering.py --outputESDFile testESD.root --outputAODFile testAOD.root --maxEvents 10</options_atn>
  <timelimit>30</timelimit>
  <author>John Chapman</author>
   <mailto> Susumu.Oda@cern.ch </mailto>
  <prescript>rm -f $ATN_WORK_AREA/testESD.root $ATN_WORK_AREA/testAOD.root</prescript>
  <expectations>
    <errorMessage>FAILURE (ERROR)</errorMessage>
    <returnValue>0</returnValue>
  </expectations>
</TEST>


<TEST name="Digi_tf_SLHC_single_particle_intime_pileup_digi" type="script" suite="InDetSLHC_Example">
      <options_atn>
	xrdcp root://eosatlas//eos/atlas/atlascerngroupdisk/det-slhc/users/oda/HITSexample/mc12_14TeV.119995.Pythia8_A2MSTW2008LO_minbias_inelastic_low.HITS.e1133_19.2.1_000001_200evt.pool.root $ATN_WORK_AREA;
	xrdcp root://eosatlas//eos/atlas/atlascerngroupdisk/det-slhc/users/oda/HITSexample/mc12_14TeV.119996.Pythia8_A2MSTW2008LO_minbias_inelastic_high.HITS.e1133_19.2.1_000001_50evt.pool.root $ATN_WORK_AREA;
	export TRF_ECHO=True; 
	Digi_tf.py --inputHITSFile=test.HITS.pool.root --outputRDOFile=test.RDO.pool.root --maxEvents=10 --skipEvents=0 --preInclude='HITtoRDO:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py,InDetSLHC_Example/preInclude.digitization_metadata_hacks.py' --geometryVersion=ATLAS-P2-ITK-01-00-00 --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='HITtoRDO:InDetSLHC_Example/postInclude.SLHC_Digitization.py,InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py' --digiSeedOffset1=11 --digiSeedOffset2=22 --doAllNoise=False --numberOfLowPtMinBias=49.8273 --numberOfHighPtMinBias=0.1727 --pileupInitialBunch=0 --pileupFinalBunch=0 --bunchSpacing=900 --inputLowPtMinbiasHitsFile=mc12_14TeV.119995.Pythia8_A2MSTW2008LO_minbias_inelastic_low.HITS.e1133_19.2.1_000001_200evt.pool.root --inputHighPtMinbiasHitsFile=mc12_14TeV.119996.Pythia8_A2MSTW2008LO_minbias_inelastic_high.HITS.e1133_19.2.1_000001_50evt.pool.root
      </options_atn>
      <timelimit>30</timelimit>
      <author>John Chapman</author>
      <prescript>rm -f $ATN_WORK_AREA/test.RDO.pool.root</prescript>
      <expectations>
            <errorMessage>FAILURE (ERROR)</errorMessage>
            <returnValue>0</returnValue>
       </expectations>
    </TEST>

</atn>

<kv>

  <kvtest name='AtlasG4ZeeJet_SLHC' enabled='true'>
    <release>ALL</release>
    <priority>20</priority>
    <kvsuite>InDetSLHC</kvsuite>
    <trf>AtlasG4_tf.py</trf>
    <desc>Z -> e e jet G4 event atlasG4 (InDetSLHC_Example)</desc>
    <author>Silvia Miglioranzi [Silvia.Miglioranzi@cern.ch],John Chapman [chapman@hep.phy.cam.ac.uk]</author>
    <inpath>${T_DATAPATH}/EvgenZeePyJT-${T_RELEASE}</inpath>
    <infile>${T_PREFIX}-EvgenZeePyJT-${T_RELEASE}.pool.root</infile>
    <inpool>PoolFileCatalog.xml</inpool>
    <outpath>${T_DATAPATH}/SimulHITSZeeJetInDetSLHC-${T_RELEASE}</outpath>
    <outfile>${T_PREFIX}-SimulHITSZeeJetInDetSLHC-${T_RELEASE}.pool.root</outfile>
    <logfile>${T_PREFIX}-SimulHITSZeeJetInDetSLHC-${T_RELEASE}.log</logfile>
    <signature>
      --inputEVNTFile="${T_INFILE}" --outputHITSFile="${T_OUTFILE}" --maxEvents=10 --skipEvents=0 --randomSeed=26741007 --preInclude='sim:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py,InDetSLHC_Example/preInclude.OverrideBFieldTag.py,KitValidation/kv_reflex.py' --geometryVersion=ATLAS-P2-ITK-01-00-00_VALIDATION --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='sim:InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py'
    </signature>
    <copyfiles>
      ${T_OUTFILE} ${T_LOGFILE} PoolFileCatalog.xml metadata.xml jobInfo.xml
    </copyfiles>
    <checkfiles>${T_OUTPATH}/${T_OUTFILE}</checkfiles>
  </kvtest>
  <kvtest name='DigitZeeJet_SLHC' enabled='true'>
    <release>ALL</release>
    <priority>30</priority>
    <kvsuite>InDetSLHC</kvsuite>
    <trf>Digi_tf.py</trf>
    <desc>Z -> e e jet Digitization (InDetSLHC_Example)</desc>
    <author>Silvia Miglioranzi [Silvia.Miglioranzi@cern.ch],John Chapman [chapman@hep.phy.cam.ac.uk]</author>
    <version>1.0.0</version>
    <inpath>${T_DATAPATH}/SimulHITSZeeJetInDetSLHC-${T_RELEASE}</inpath>
    <infile>${T_PREFIX}-SimulHITSZeeJetInDetSLHC-${T_RELEASE}.pool.root</infile>
    <inpool>PoolFileCatalog.xml</inpool>
    <outpath>${T_DATAPATH}/DigitZeeJetInDetSLHC-${T_RELEASE}</outpath>
    <outfile>${T_PREFIX}-DigitZeeJetInDetSLHC-${T_RELEASE}.pool.root</outfile>
    <logfile>${T_PREFIX}-DigitZeeJetInDetSLHC-${T_RELEASE}.log</logfile>
    <signature>
      --inputHITSFile="${T_INFILE}" --outputRDOFile="${T_OUTFILE}" --maxEvents=10 --skipEvents=0 --preInclude='HITtoRDO:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py,KitValidation/kv_reflex.py' --geometryVersion=ATLAS-P2-ITK-01-00-00 --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='HITtoRDO:InDetSLHC_Example/postInclude.SLHC_Digitization.py,InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py' --digiSeedOffset1=11 --digiSeedOffset2=22 --doAllNoise=False
    </signature>
    <copyfiles>
      ${T_OUTFILE} ${T_LOGFILE} PoolFileCatalog.xml metadata.xml
    </copyfiles>
    <checkfiles>${T_OUTPATH}/${T_OUTFILE}</checkfiles>
  </kvtest>
  <kvtest name='RecoZeeJet_SLHC' enabled='true'>
    <release>ALL</release>
    <priority>40</priority>
    <kvsuite>InDetSLHC</kvsuite>
    <trf>Reco_tf.py</trf>
    <desc>Z -> e e jet event reconstruction (InDetSLHC_Example)</desc>
    <author>Silvia Miglioranzi [Silvia.Miglioranzi@cern.ch],John Chapman [chapman@hep.phy.cam.ac.uk]</author>
    <inpath>${T_DATAPATH}/DigitZeeJetInDetSLHC-${T_RELEASE}</inpath>
    <infile>${T_PREFIX}-DigitZeeJetInDetSLHC-${T_RELEASE}.pool.root</infile>
    <inpool>PoolFileCatalog.xml</inpool>
    <outpath>${T_DATAPATH}/RecoZeeJetInDetSLHC-${T_RELEASE}</outpath>
    <outfile>${T_PREFIX}-RecoESDZeeJetInDetSLHC-${T_RELEASE}.pool.root</outfile>
    <logfile>${T_PREFIX}-RecoZeeJetInDetSLHC-${T_RELEASE}.log</logfile>
    <signature>
      --inputRDOFile="${T_INFILE}" --outputESDFile="${T_OUTFILE}" --preInclude InDetSLHC_Example/preInclude.SLHC.SiliconOnly.Reco.py --postInclude InDetSLHC_Example/postInclude.SLHC_Setup.py,KitValidation/kv_reflex.py r2e:InDetSLHC_Example/postInclude.DigitalClustering.py --maxEvents=5 --geometryVersion=ATLAS-P2-ITK-01-00-00
    </signature>
    <copyfiles>
       ${T_OUTFILE} ${T_LOGFILE} PoolFileCatalog.xml metadata.xml jobInfo.xml
    </copyfiles>
    <checkfiles>${T_OUTPATH}/${T_OUTFILE}</checkfiles>
  </kvtest>

</kv>
<rtt xmlns="http://www.hep.ucl.ac.uk/atlas/AtlasTesting/rtt">
  <rttContactPerson>Andreas Korn</rttContactPerson>
  <mailto>atlas.indetslhcrtt.monitoring@cern.ch</mailto>
        <refRelease>15.0.0</refRelease>

   <jobList>

      <classification>
         <displayClass>OfflineValidation</displayClass>
         <displayProcess>Reco</displayProcess>
         <displayComponent>Det-InDet</displayComponent>
      </classification>

     <chain>
     <chainName>SLHCChainTest</chainName>
     <sequential>
     <chainElement>
     <jobTransform userJobId="SLHCGen">
     <doc>SLHCSimulation</doc>
     <jobTransformJobName>chainG4SLHCRTT</jobTransformJobName>
     <jobTransformCmd>AtlasG4_tf.py --inputEVNTFile=/afs/cern.ch/atlas/offline/ProdData/15.6.11.3/e_E50_eta0-25-7000.evgen.pool.root --outputHITSFile=SLHCtest.HITS.pool.root --maxEvents=500 --skipEvents=0 --randomSeed=10 --preInclude='sim:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py' --geometryVersion=ATLAS-P2-ITK-01-00-00_VALIDATION --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='sim:InDetSLHC_Example/postInclude.SLHC_Setup.py'
     </jobTransformCmd>
     <group>SLHCFCTTransform</group>
     <queue>medium</queue>
     </jobTransform>
     <chainfileout>SLHCtest.HITS.pool.root</chainfileout>
     </chainElement>

     <chainElement>
     <jobTransform userJobId="SLHCDigi">
     <doc>SLHCDigitization</doc>
     <jobTransformJobName>chainDigiSLHCRTT</jobTransformJobName>
     <jobTransformCmd> Digi_tf.py --inputHITSFile=SLHCtest.HITS.pool.root --outputRDOFile=SLHCtest.RDO.pool.root --maxEvents=500 --skipEvents=0 --preInclude='HITtoRDO:InDetSLHC_Example/preInclude.SLHC.py,InDetSLHC_Example/preInclude.SiliconOnly.py' --geometryVersion=ATLAS-P2-ITK-01-00-00 --conditionsTag=OFLCOND-ATLAS-HL-LHC-00 --postInclude='HITtoRDO:InDetSLHC_Example/postInclude.SLHC_Digitization.py,InDetSLHC_Example/postInclude.SLHC_Setup.py,RecJobTransforms/UseFrontier.py' --digiSeedOffset1=11 --digiSeedOffset2=22 --doAllNoise=False
     </jobTransformCmd>
     <group>SLHCFCTTransform</group>
     <chaindataset_info>
     <jobTransformData/>
     <chaindatasetName>SLHCtest.HITS.pool.root</chaindatasetName>
     <dataset_info>
     <jobTransformData/>
     <datasetName>NONE.pool.root</datasetName>
     </dataset_info>
     </chaindataset_info>
     <queue>medium</queue>
     </jobTransform>
     <chainfileout>SLHCtest.RDO.pool.root</chainfileout>
     </chainElement>

     <chainElement>
     <jobTransform userJobId="SLHCReco">
     <doc>SLHCReconstruction</doc>
     <jobTransformJobName>chainRecoSLHCRTT</jobTransformJobName>
     <jobTransformCmd> Reco_tf.py --inputRDOFile=SLHCtest.RDO.pool.root --preInclude InDetSLHC_Example/preInclude.SLHC.SiliconOnly.Reco.py --postInclude InDetSLHC_Example/postInclude.SLHC_Setup.py r2e:InDetSLHC_Example/postInclude.DigitalClustering.py --outputESDFile=SLHCtest.ESD.pool.root --maxEvents=500  --geometryVersion=ATLAS-P2-ITK-01-00-00 --outputAODFile=SLHCtest.AOD.pool.root
     </jobTransformCmd>
     <group>SLHCFCTTransform</group>
     <chaindataset_info>
     <jobTransformData/>
     <chaindatasetName>SLHCtest.RDO.pool.root</chaindatasetName>
     <dataset_info>
     <jobTransformData/>
     <datasetName>NONE.pool.root</datasetName>
     </dataset_info>
     </chaindataset_info>
     <queue>medium</queue>
     </jobTransform>
     <chainfileout>SLHCtest.ESD.pool.root</chainfileout>
     </chainElement>

     </sequential>
     </chain>
     </jobList>
<jobGroups>
 <jobGroup name="SLHCFCTTransform" parent="Transform">
    <keepFilePattern>*.root</keepFilePattern>
    <keepFilePattern>*.pdf</keepFilePattern>
    <keepFilePattern>*.log</keepFilePattern>
    <keepFilePattern>log.*</keepFilePattern>
 </jobGroup>

</jobGroups>
</rtt>

</unifiedTestConfiguration>
